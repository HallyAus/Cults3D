# ============================================================================
# Cults3D Creator Dashboard for Home Assistant
# ============================================================================
#
# SETUP INSTRUCTIONS:
#   1. Replace ALL instances of "USERNAME" below with your Cults3D username
#      (lowercase, as it appears in your entity IDs).
#      Tip: Go to Developer Tools > States and search "cults3d" to find
#      your exact entity IDs.
#
#   2. Install this dashboard:
#      - Go to Settings > Dashboards > Add Dashboard
#      - Choose "New dashboard from scratch"
#      - Edit dashboard > Raw configuration editor (three dots menu)
#      - Paste this YAML and save
#
#   3. Optional HACS frontend cards for the best experience:
#      - mushroom (mushroom-entity-card, mushroom-template-card)
#      - mini-graph-card
#      - If you don't have these, the dashboard still works with
#        standard HA cards.
#
# ============================================================================

title: Cults3D Creator Hub
views:
  - title: Overview
    path: overview
    icon: mdi:printer-3d-nozzle
    type: sections
    max_columns: 4
    sections:
      # ================================================================
      # ROW 1: Profile Header
      # ================================================================
      - type: grid
        column_span: 4
        cards:
          - type: markdown
            content: >-
              # üé® Cults3D Creator Dashboard

              **Profile:**
              [{{ state_attr('sensor.cults3d_USERNAME_latest_creation', 'friendly_name').split('(')[1].split(')')[0] if state_attr('sensor.cults3d_USERNAME_latest_creation', 'friendly_name') else 'USERNAME' }}](https://cults3d.com/en/users/USERNAME)
              &nbsp; | &nbsp;
              {{ states('sensor.cults3d_USERNAME_creations') }} creations
              &nbsp; | &nbsp;
              {{ states('sensor.cults3d_USERNAME_followers') }} followers
              &nbsp; | &nbsp;
              {{ states('sensor.cults3d_USERNAME_following') }} following

      # ================================================================
      # ROW 2: Key Metrics (KPI Cards)
      # ================================================================
      - type: grid
        column_span: 2
        cards:
          - type: heading
            heading: Profile Stats
            heading_style: title
            icon: mdi:account

          - type: tile
            entity: sensor.cults3d_USERNAME_followers
            name: Followers
            icon: mdi:account-multiple
            color: blue

          - type: tile
            entity: sensor.cults3d_USERNAME_following
            name: Following
            icon: mdi:account-multiple-outline
            color: cyan

          - type: tile
            entity: sensor.cults3d_USERNAME_creations
            name: Total Creations
            icon: mdi:cube-outline
            color: purple

      - type: grid
        column_span: 2
        cards:
          - type: heading
            heading: Sales Performance
            heading_style: title
            icon: mdi:cash-register

          - type: tile
            entity: sensor.cults3d_USERNAME_total_earnings
            name: Lifetime Revenue
            icon: mdi:currency-eur
            color: green

          - type: tile
            entity: sensor.cults3d_USERNAME_total_sales
            name: Lifetime Sales
            icon: mdi:cart-check
            color: teal

          - type: tile
            entity: sensor.cults3d_USERNAME_monthly_earnings
            name: Monthly Revenue
            icon: mdi:calendar-month
            color: amber

          - type: tile
            entity: sensor.cults3d_USERNAME_monthly_sales
            name: Monthly Sales
            icon: mdi:calendar-check
            color: orange

      # ================================================================
      # ROW 3: Sales Charts
      # ================================================================
      - type: grid
        column_span: 2
        cards:
          - type: heading
            heading: Revenue Trends
            heading_style: title
            icon: mdi:chart-line

          - type: statistics-graph
            entities:
              - entity: sensor.cults3d_USERNAME_total_earnings
                name: Total Revenue
              - entity: sensor.cults3d_USERNAME_monthly_earnings
                name: Monthly Revenue
            stat_types:
              - state
              - mean
            days_to_show: 30
            period: day
            chart_type: line

          - type: statistics-graph
            entities:
              - entity: sensor.cults3d_USERNAME_total_sales
                name: Total Sales
              - entity: sensor.cults3d_USERNAME_monthly_sales
                name: Monthly Sales
            stat_types:
              - state
              - mean
            days_to_show: 30
            period: day
            chart_type: bar

      # ================================================================
      # ROW 3 (cont): Profile Growth Charts
      # ================================================================
      - type: grid
        column_span: 2
        cards:
          - type: heading
            heading: Growth Trends
            heading_style: title
            icon: mdi:trending-up

          - type: statistics-graph
            entities:
              - entity: sensor.cults3d_USERNAME_followers
                name: Followers
              - entity: sensor.cults3d_USERNAME_creations
                name: Creations
            stat_types:
              - state
            days_to_show: 30
            period: day
            chart_type: line

      # ================================================================
      # ROW 4: Featured Creations
      # ================================================================
      - type: grid
        column_span: 2
        cards:
          - type: heading
            heading: Latest Creation
            heading_style: title
            icon: mdi:new-box

          - type: markdown
            content: >-
              {% set entity = 'sensor.cults3d_USERNAME_latest_creation' %}
              {% set name = states(entity) %}
              {% set url = state_attr(entity, 'url') %}
              {% set image = state_attr(entity, 'image_url') %}
              {% set views = state_attr(entity, 'views') %}
              {% set downloads = state_attr(entity, 'downloads') %}
              {% set likes = state_attr(entity, 'likes') %}
              {% set published = state_attr(entity, 'published_at') %}

              {% if image %}
              ![{{ name }}]({{ image }})
              {% endif %}

              ### {{ name or 'No creations yet' }}

              {% if url %}[View on Cults3D]({{ url }}){% endif %}

              {% if name %}

              | Metric | Count |
              |--------|-------|
              | üëÅÔ∏è Views | {{ views or 0 }} |
              | ‚¨áÔ∏è Downloads | {{ downloads or 0 }} |
              | ‚ù§Ô∏è Likes | {{ likes or 0 }} |

              {% if published %}
              *Published: {{ as_timestamp(published) | timestamp_custom('%B %d, %Y') }}*
              {% endif %}
              {% endif %}

      - type: grid
        column_span: 2
        cards:
          - type: heading
            heading: Top Downloaded
            heading_style: title
            icon: mdi:trending-up

          - type: markdown
            content: >-
              {% set entity = 'sensor.cults3d_USERNAME_top_downloaded' %}
              {% set name = states(entity) %}
              {% set url = state_attr(entity, 'url') %}
              {% set image = state_attr(entity, 'image_url') %}
              {% set views = state_attr(entity, 'views') %}
              {% set downloads = state_attr(entity, 'downloads') %}
              {% set likes = state_attr(entity, 'likes') %}
              {% set published = state_attr(entity, 'published_at') %}

              {% if image %}
              ![{{ name }}]({{ image }})
              {% endif %}

              ### {{ name or 'No creations yet' }}

              {% if url %}[View on Cults3D]({{ url }}){% endif %}

              {% if name %}

              | Metric | Count |
              |--------|-------|
              | üëÅÔ∏è Views | {{ views or 0 }} |
              | ‚¨áÔ∏è Downloads | {{ downloads or 0 }} |
              | ‚ù§Ô∏è Likes | {{ likes or 0 }} |

              {% if published %}
              *Published: {{ as_timestamp(published) | timestamp_custom('%B %d, %Y') }}*
              {% endif %}
              {% endif %}

      # ================================================================
      # ROW 5: Monthly Performance Summary
      # ================================================================
      - type: grid
        column_span: 4
        cards:
          - type: heading
            heading: Monthly Performance Summary
            heading_style: title
            icon: mdi:finance

          - type: markdown
            content: >-
              {% set monthly_rev = states('sensor.cults3d_USERNAME_monthly_earnings') | float(0) %}
              {% set monthly_sales = states('sensor.cults3d_USERNAME_monthly_sales') | int(0) %}
              {% set total_rev = states('sensor.cults3d_USERNAME_total_earnings') | float(0) %}
              {% set total_sales = states('sensor.cults3d_USERNAME_total_sales') | int(0) %}
              {% set avg_price = (monthly_rev / monthly_sales) | round(2) if monthly_sales > 0 else 0 %}
              {% set total_avg = (total_rev / total_sales) | round(2) if total_sales > 0 else 0 %}

              | | This Month | All Time |
              |---|---|---|
              | **Revenue** | ‚Ç¨{{ monthly_rev | round(2) }} | ‚Ç¨{{ total_rev | round(2) }} |
              | **Sales** | {{ monthly_sales }} | {{ total_sales }} |
              | **Avg. Sale** | ‚Ç¨{{ avg_price }} | ‚Ç¨{{ total_avg }} |

              {% if monthly_sales > 0 %}
              > üìà Averaging **‚Ç¨{{ (monthly_rev / 30) | round(2) }}/day** this month
              {% else %}
              > No sales recorded this month yet
              {% endif %}

  # ====================================================================
  # VIEW 2: Tracked Creations (Competitor Analysis)
  # ====================================================================
  - title: Tracked Creations
    path: tracked
    icon: mdi:chart-timeline-variant
    type: sections
    max_columns: 3
    sections:
      - type: grid
        column_span: 3
        cards:
          - type: markdown
            content: >-
              # üîç Tracked Creations

              Monitor other creators' designs and their performance metrics.
              Add creations to track via **Settings > Devices > Cults3D > Configure**.

              > **Note:** Sales data for non-owned creations is **not available**
              > via the Cults3D API. Downloads, views, and likes are shown as
              > proxy metrics for popularity.

          # ----------------------------------------------------------------
          # Tracked creations will appear here automatically.
          # Each tracked creation gets its own sensor entity named:
          #   sensor.cults3d_tracked_creations_tracked_SLUG
          #
          # Add markdown cards below for each tracked creation you add.
          # Here's a template you can copy for each tracked creation:
          # ----------------------------------------------------------------

          # TEMPLATE: Copy this block for each tracked creation
          # Replace ENTITY_ID with your tracked creation's entity ID
          # (check Developer Tools > States for the exact entity ID)
          #
          # - type: markdown
          #   content: >-
          #     {% set entity = 'sensor.ENTITY_ID' %}
          #     {% set name = state_attr(entity, 'name') %}
          #     {% set creator = state_attr(entity, 'creator') %}
          #     {% set url = state_attr(entity, 'url') %}
          #     {% set image = state_attr(entity, 'image_url') %}
          #     {% set views = state_attr(entity, 'views_total') %}
          #     {% set downloads = state_attr(entity, 'downloads_total') %}
          #     {% set likes = state_attr(entity, 'likes_total') %}
          #     {% set in_window = state_attr(entity, 'is_within_30_day_window') %}
          #     {% set window_end = state_attr(entity, 'window_end') %}
          #     {% set published = state_attr(entity, 'published_at') %}
          #
          #     {% if image %}
          #     ![{{ name }}]({{ image }})
          #     {% endif %}
          #
          #     ### {{ name or 'Unknown' }}
          #     **By:** {{ creator or 'Unknown' }}
          #     {% if url %}| [View on Cults3D]({{ url }}){% endif %}
          #
          #     | Metric | Total |
          #     |--------|-------|
          #     | üëÅÔ∏è Views | {{ views or 0 }} |
          #     | ‚¨áÔ∏è Downloads | {{ downloads or 0 }} |
          #     | ‚ù§Ô∏è Likes | {{ likes or 0 }} |
          #
          #     {% if in_window %}
          #     üü¢ **Within 30-day launch window**
          #     (ends {{ as_timestamp(window_end) | timestamp_custom('%B %d, %Y') }})
          #     {% else %}
          #     üî¥ **30-day launch window closed**
          #     {% endif %}

  # ====================================================================
  # VIEW 3: Automations & Tools
  # ====================================================================
  - title: Automations
    path: automations
    icon: mdi:robot
    type: sections
    max_columns: 2
    sections:
      - type: grid
        column_span: 2
        cards:
          - type: markdown
            content: >-
              # ‚ö° Automation Ideas

              Here are some automation ideas you can set up in Home Assistant
              using your Cults3D sensors:


              ### üì¨ New Sale Notification

              ```yaml
              automation:
                - alias: "Cults3D New Sale"
                  trigger:
                    - platform: state
                      entity_id: sensor.cults3d_USERNAME_total_sales
                  condition:
                    - condition: template
                      value_template: >
                        {{ trigger.to_state.state | int > trigger.from_state.state | int }}
                  action:
                    - service: notify.mobile_app_YOUR_PHONE
                      data:
                        title: "üí∞ New Cults3D Sale!"
                        message: >
                          You made a sale! Monthly total: ‚Ç¨{{ states('sensor.cults3d_USERNAME_monthly_earnings') }}
                        data:
                          url: "https://cults3d.com/en/users/USERNAME/sales"
              ```

              ### üìä Daily Sales Report

              ```yaml
              automation:
                - alias: "Cults3D Daily Report"
                  trigger:
                    - platform: time
                      at: "20:00:00"
                  action:
                    - service: notify.mobile_app_YOUR_PHONE
                      data:
                        title: "üìä Cults3D Daily Report"
                        message: >
                          Followers: {{ states('sensor.cults3d_USERNAME_followers') }}
                          Monthly Sales: {{ states('sensor.cults3d_USERNAME_monthly_sales') }}
                          Monthly Revenue: ‚Ç¨{{ states('sensor.cults3d_USERNAME_monthly_earnings') }}
                          Latest: {{ states('sensor.cults3d_USERNAME_latest_creation') }}
              ```

              ### üéâ Follower Milestone

              ```yaml
              automation:
                - alias: "Cults3D Follower Milestone"
                  trigger:
                    - platform: numeric_state
                      entity_id: sensor.cults3d_USERNAME_followers
                      above: 100  # Change to your target
                  action:
                    - service: notify.mobile_app_YOUR_PHONE
                      data:
                        title: "üéâ Milestone Reached!"
                        message: >
                          You've reached {{ states('sensor.cults3d_USERNAME_followers') }} followers on Cults3D!
              ```


              ---

              *Replace `USERNAME` with your Cults3D username and
              `YOUR_PHONE` with your mobile app notify service.*

      - type: grid
        column_span: 2
        cards:
          - type: markdown
            content: >-
              ---

              Made with ‚ù§Ô∏è by [PrintForge](https://cults3d.com/en/users/PrintForge)

              [‚òï Buy Me a Coffee](https://buymeacoffee.com/printforge)
              &nbsp; | &nbsp;
              [‚≠ê GitHub](https://github.com/HallyAus/Cults3D)

# ============================================================================
# Cults3D Creator Dashboard for Home Assistant
# ============================================================================
#
# SETUP INSTRUCTIONS:
#   1. Replace ALL instances of "printforgeau" below with your Cults3D username
#      (lowercase, as it appears in your entity IDs).
#      Tip: Go to Developer Tools > States and search "cults3d" to find
#      your exact entity IDs.
#
#   2. Install this dashboard:
#      - Go to Settings > Dashboards > Add Dashboard
#      - Choose "New dashboard from scratch"
#      - Edit dashboard > Raw configuration editor (three dots menu)
#      - Paste this YAML and save
#
# ============================================================================

title: Cults3D Creator Hub
views:
  - title: Overview
    path: overview
    icon: mdi:printer-3d-nozzle
    type: sections
    max_columns: 4
    sections:
      # ================================================================
      # ROW 1: Profile Header
      # ================================================================
      - type: grid
        column_span: 4
        cards:
          - type: markdown
            content: >-
              # Cults3D Creator Dashboard

              **Profile:** [PrintforgeAU](https://cults3d.com/en/users/PrintforgeAU)
              |
              {{ states('sensor.cults3d_printforgeau_creations') }} creations
              |
              {{ states('sensor.cults3d_printforgeau_followers') }} followers
              |
              {{ states('sensor.cults3d_printforgeau_following') }} following

      # ================================================================
      # ROW 2: Key Metrics (KPI Cards)
      # ================================================================
      - type: grid
        column_span: 2
        cards:
          - type: heading
            heading: Profile Stats
            heading_style: title
            icon: mdi:account

          - type: tile
            entity: sensor.cults3d_printforgeau_followers
            name: Followers
            icon: mdi:account-multiple
            color: blue

          - type: tile
            entity: sensor.cults3d_printforgeau_following
            name: Following
            icon: mdi:account-multiple-outline
            color: cyan

          - type: tile
            entity: sensor.cults3d_printforgeau_creations
            name: Total Creations
            icon: mdi:cube-outline
            color: purple

      - type: grid
        column_span: 2
        cards:
          - type: heading
            heading: Sales Performance
            heading_style: title
            icon: mdi:cash-register

          - type: tile
            entity: sensor.cults3d_printforgeau_total_earnings
            name: Lifetime Revenue
            icon: mdi:currency-eur
            color: green

          - type: tile
            entity: sensor.cults3d_printforgeau_total_sales
            name: Lifetime Sales
            icon: mdi:cart-check
            color: teal

          - type: tile
            entity: sensor.cults3d_printforgeau_monthly_earnings
            name: Monthly Revenue
            icon: mdi:calendar-month
            color: amber

          - type: tile
            entity: sensor.cults3d_printforgeau_monthly_sales
            name: Monthly Sales
            icon: mdi:calendar-check
            color: orange

      # ================================================================
      # ROW 3: Sales Charts
      # ================================================================
      - type: grid
        column_span: 2
        cards:
          - type: heading
            heading: Revenue Trends
            heading_style: title
            icon: mdi:chart-line

          - type: history-graph
            entities:
              - entity: sensor.cults3d_printforgeau_total_earnings
                name: Total Revenue
              - entity: sensor.cults3d_printforgeau_monthly_earnings
                name: Monthly Revenue
            hours_to_show: 168

          - type: history-graph
            entities:
              - entity: sensor.cults3d_printforgeau_total_sales
                name: Total Sales
              - entity: sensor.cults3d_printforgeau_monthly_sales
                name: Monthly Sales
            hours_to_show: 168

      # ================================================================
      # ROW 3 (cont): Profile Growth Charts
      # ================================================================
      - type: grid
        column_span: 2
        cards:
          - type: heading
            heading: Growth Trends
            heading_style: title
            icon: mdi:trending-up

          - type: history-graph
            entities:
              - entity: sensor.cults3d_printforgeau_followers
                name: Followers
              - entity: sensor.cults3d_printforgeau_creations
                name: Creations
            hours_to_show: 168

      # ================================================================
      # ROW 4: Featured Creations
      # ================================================================
      - type: grid
        column_span: 2
        cards:
          - type: heading
            heading: Latest Creation
            heading_style: title
            icon: mdi:new-box

          - type: markdown
            content: >-
              {% set entity = 'sensor.cults3d_printforgeau_latest_creation' %}
              {% set name = states(entity) %}
              {% set url = state_attr(entity, 'url') %}
              {% set image = state_attr(entity, 'image_url') %}
              {% set views = state_attr(entity, 'views') %}
              {% set downloads = state_attr(entity, 'downloads') %}
              {% set likes = state_attr(entity, 'likes') %}
              {% set published = state_attr(entity, 'published_at') %}

              {% if image %}
              ![{{ name }}]({{ image }})
              {% endif %}

              ### {{ name[:50] ~ '...' if name|length > 50 else name }}

              {% if url %}[View on Cults3D]({{ url }}){% endif %}

              {% if name %}

              | Metric | Count |
              |--------|-------|
              | Views | {{ views | default(0) }} |
              | Downloads | {{ downloads | default(0) }} |
              | Likes | {{ likes | default(0) }} |

              {% if published %}
              *Published: {{ as_timestamp(published) | timestamp_custom('%B %d, %Y') }}*
              {% endif %}
              {% endif %}

      - type: grid
        column_span: 2
        cards:
          - type: heading
            heading: Top Downloaded
            heading_style: title
            icon: mdi:trending-up

          - type: markdown
            content: >-
              {% set entity = 'sensor.cults3d_printforgeau_top_downloaded_trending' %}
              {% set name = states(entity) %}
              {% set url = state_attr(entity, 'url') %}
              {% set image = state_attr(entity, 'image_url') %}
              {% set views = state_attr(entity, 'views') %}
              {% set downloads = state_attr(entity, 'downloads') %}
              {% set likes = state_attr(entity, 'likes') %}
              {% set published = state_attr(entity, 'published_at') %}

              {% if image %}
              ![{{ name }}]({{ image }})
              {% endif %}

              ### {{ name[:50] ~ '...' if name|length > 50 else name }}

              {% if url %}[View on Cults3D]({{ url }}){% endif %}

              {% if name %}

              | Metric | Count |
              |--------|-------|
              | Views | {{ views | default(0) }} |
              | Downloads | {{ downloads | default(0) }} |
              | Likes | {{ likes | default(0) }} |

              {% if published %}
              *Published: {{ as_timestamp(published) | timestamp_custom('%B %d, %Y') }}*
              {% endif %}
              {% endif %}

      # ================================================================
      # ROW 5: Monthly Performance Summary
      # ================================================================
      - type: grid
        column_span: 4
        cards:
          - type: heading
            heading: Monthly Performance Summary
            heading_style: title
            icon: mdi:finance

          - type: markdown
            content: >-
              {% set monthly_rev = states('sensor.cults3d_printforgeau_monthly_earnings') | float(0) %}
              {% set monthly_sales = states('sensor.cults3d_printforgeau_monthly_sales') | int(0) %}
              {% set total_rev = states('sensor.cults3d_printforgeau_total_earnings') | float(0) %}
              {% set total_sales = states('sensor.cults3d_printforgeau_total_sales') | int(0) %}
              {% set avg_price = (monthly_rev / monthly_sales) | round(2) if monthly_sales > 0 else 0 %}
              {% set total_avg = (total_rev / total_sales) | round(2) if total_sales > 0 else 0 %}

              | | This Month | All Time |
              |---|---|---|
              | **Revenue** | {{ monthly_rev | round(2) }} EUR | {{ total_rev | round(2) }} EUR |
              | **Sales** | {{ monthly_sales }} | {{ total_sales }} |
              | **Avg. Sale** | {{ avg_price }} EUR | {{ total_avg }} EUR |

              {% if monthly_sales > 0 %}
              > Averaging **{{ (monthly_rev / 30) | round(2) }} EUR/day** this month
              {% else %}
              > No sales recorded this month yet
              {% endif %}

  # ====================================================================
  # VIEW 2: All Entities
  # ====================================================================
  - title: All Sensors
    path: sensors
    icon: mdi:format-list-bulleted
    type: sections
    max_columns: 2
    sections:
      - type: grid
        column_span: 2
        cards:
          - type: entities
            title: Profile Stats
            entities:
              - entity: sensor.cults3d_printforgeau_followers
              - entity: sensor.cults3d_printforgeau_following
              - entity: sensor.cults3d_printforgeau_creations

          - type: entities
            title: Sales & Earnings
            entities:
              - entity: sensor.cults3d_printforgeau_total_earnings
              - entity: sensor.cults3d_printforgeau_total_sales
              - entity: sensor.cults3d_printforgeau_monthly_earnings
              - entity: sensor.cults3d_printforgeau_monthly_sales

          - type: entities
            title: Featured Creations
            entities:
              - entity: sensor.cults3d_printforgeau_latest_creation
              - entity: sensor.cults3d_printforgeau_top_downloaded_trending

  # ====================================================================
  # VIEW 3: Automations & Tools
  # ====================================================================
  - title: Automations
    path: automations
    icon: mdi:robot
    type: sections
    max_columns: 2
    sections:
      - type: grid
        column_span: 2
        cards:
          - type: markdown
            content: >-
              # Automation Ideas

              Here are some automation ideas you can set up in Home Assistant
              using your Cults3D sensors:


              ### New Sale Notification

              ```yaml
              automation:
                - alias: "Cults3D New Sale"
                  trigger:
                    - platform: state
                      entity_id: sensor.cults3d_printforgeau_total_sales
                  condition:
                    - condition: template
                      value_template: >
                        {{ trigger.to_state.state | int > trigger.from_state.state | int }}
                  action:
                    - service: notify.mobile_app_YOUR_PHONE
                      data:
                        title: "New Cults3D Sale!"
                        message: >
                          You made a sale! Monthly total: {{ states('sensor.cults3d_printforgeau_monthly_earnings') }} EUR
                        data:
                          url: "https://cults3d.com/en/users/PrintforgeAU/sales"
              ```

              ### Daily Sales Report

              ```yaml
              automation:
                - alias: "Cults3D Daily Report"
                  trigger:
                    - platform: time
                      at: "20:00:00"
                  action:
                    - service: notify.mobile_app_YOUR_PHONE
                      data:
                        title: "Cults3D Daily Report"
                        message: >
                          Followers: {{ states('sensor.cults3d_printforgeau_followers') }}
                          Monthly Sales: {{ states('sensor.cults3d_printforgeau_monthly_sales') }}
                          Monthly Revenue: {{ states('sensor.cults3d_printforgeau_monthly_earnings') }} EUR
                          Latest: {{ states('sensor.cults3d_printforgeau_latest_creation')[:40] }}
              ```

              ### Follower Milestone

              ```yaml
              automation:
                - alias: "Cults3D Follower Milestone"
                  trigger:
                    - platform: numeric_state
                      entity_id: sensor.cults3d_printforgeau_followers
                      above: 100
                  action:
                    - service: notify.mobile_app_YOUR_PHONE
                      data:
                        title: "Milestone Reached!"
                        message: >
                          You've reached {{ states('sensor.cults3d_printforgeau_followers') }} followers on Cults3D!
              ```


              ---

              *Replace `YOUR_PHONE` with your mobile app notify service.*

      - type: grid
        column_span: 2
        cards:
          - type: markdown
            content: >-
              ---

              Made with love by [PrintForge](https://cults3d.com/en/users/PrintforgeAU)

              [Buy Me a Coffee](https://buymeacoffee.com/printforge)
              |
              [GitHub](https://github.com/HallyAus/Cults3D)
